<div class="admin-container">
  <div class="management-section">
    <div class="header-group">
      <mat-icon color="primary">manage_accounts</mat-icon>
      <h2>User Role Management</h2>
      
      <span class="flex-spacer"></span>

      <mat-form-field appearance="outline" class="search-box">
        <mat-label>Search by email</mat-label>
        <input matInput (input)="onSearch($event)" placeholder="Search users by email...">
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
    </div>
    
    <table mat-table [dataSource]="users()" class="custom-table mat-elevation-z1">
      


      <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef>Email</th>
        <td mat-cell *matCellDef="let user">{{user.email}}</td>
      </ng-container>

      <ng-container matColumnDef="role">
        <th mat-header-cell *matHeaderCellDef>Current Role</th>
        <td mat-cell *matCellDef="let user">
          <span class="role-badge" [ngClass]="user.role?.toLowerCase() || ''">
            {{user.role}}
          </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Assign New Role</th>
        <td mat-cell *matCellDef="let user">
          <mat-form-field appearance="outline" class="role-select">
            <mat-select [value]="user.role" (selectionChange)="changeRole(user.id, $event.value)">
              <mat-option *ngFor="let role of roles" [value]="role">
                {{role}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <div *ngIf="users().length === 0" class="empty-state">
       <p>No users found matching your search.</p>
    </div>

    <mat-paginator 
      [length]="totalUsers()" 
      [pageSize]="pageSize" 
      [pageSizeOptions]="[5, 10, 25]"
      (page)="onPageChange($event)"
      aria-label="Select page of users">
    </mat-paginator>
  </div>
</div>